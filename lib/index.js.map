{"version":3,"sources":["../src/index.js"],"names":["TextRemark","options","container","text","remarks","links","console","error","$container","document","querySelector","classList","add","activeRemark","startSelect","$showText","createElement","className","$realText","innerText","addEvents","appendChild","updateShowText","type","data","curSection","getRange","baseOffset","extentOffset","push","index","isNaN","length","splice","warn","filter","item","section","canAdd","i","obj","baseArr","concat","curHtml","renderHashText","innerHTML","textRemark","mixinEvent","addEventListener","e","$target","target","contains","getAttribute","parseInt","remarkType","dispatchEvent","remark","remove","mySelection","__events","events","on","cb","off","undefined","curEvent","once","listener","args","apply","self","option","forEach","call","getHashText","textMap","Object","create","splitNums","sort","a","b","prevIndex","oriText","curIndex","substring","window","getSelection","max","Math","min","tagName","attrs","$dom","key","textHashMap","resHtml","remarkIndex","curObj"],"mappings":"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","sourcesContent":["export default class TextRemark {\n  constructor(options) {\n    const { container, text = '', remarks = [], links = [] } = options\n    if (!container || !text) {\n      console.error('TextRemark need a container and text')\n      return\n    }\n    if (typeof container === 'string') {\n      this.$container = document.querySelector(container)\n    } else {\n      this.$container = container\n    }\n    this.$container.classList.add('text-remark')\n    this.text = text\n    this.remarks = remarks\n    this.links = links\n    this.activeRemark = null\n    this.startSelect = false\n    //显示\n    this.$showText = createElement('div', { className: 'text-remark-content' })\n    this.$realText = createElement('div', { className: 'text-remark-content real-text' })\n    this.$realText.innerText = text\n    addEvents(this)\n    this.$container.appendChild(this.$realText)\n    this.$container.appendChild(this.$showText)\n\n    this.updateShowText()\n  }\n  addRemark(type, data = {}) {\n    // 获取当前的active\n    // data为默认的数据\n    if (this.activeRemark) {\n      let curSection = getRange(type, this.activeRemark)\n      if (curSection.baseOffset !== curSection.extentOffset) {\n        this.remarks.push({ type, baseOffset: curSection.baseOffset, extentOffset: curSection.extentOffset, data })\n        this.activeRemark = null\n        this.updateShowText()\n      }\n    }\n  }\n  removeRemark(index) {\n    if (!isNaN(index) && index >= 0 && index < this.remarks.length) {\n      this.remarks.splice(index, 1)\n      this.updateShowText()\n    } else {\n      console.warn('params index \"' + index + '\" is not right')\n    }\n  }\n  getJson() {\n    return {\n      text: this.text,\n      remarks: this.remarks.filter(item => item.type !== 'active')\n    }\n  }\n  clearActive() {\n    this.activeRemark = null\n    this.updateShowText()\n  }\n  mySelection() {\n    let section = getRange('active')\n    let canAdd = true\n    for (let i = 0; i < this.remarks.length; i++) {\n      let obj = this.remarks[i]\n      if (section.baseOffset >= obj.baseOffset && section.baseOffset <= obj.extentOffset) {\n        canAdd = false\n        break\n      } else if (section.extentOffset >= obj.baseOffset && section.extentOffset <= obj.extentOffset) {\n        canAdd = false\n        break\n      }\n    }\n    if (canAdd && section.baseOffset !== section.extentOffset) {\n      this.activeRemark = getRange('active')\n      this.updateShowText()\n    }\n  }\n  updateShowText() {\n    // 合并默认标记数据和已有的标记数据\n    let baseArr = this.activeRemark ? [this.activeRemark] : []\n    let remarks = baseArr.concat(this.remarks)\n    let curHtml = renderHashText(this.text, remarks)\n    this.$showText.innerHTML = curHtml\n  }\n}\nfunction addEvents(textRemark) {\n  mixinEvent(textRemark)\n  textRemark.$container.addEventListener(\n    'mousedown',\n    e => {\n      textRemark.$container.classList.add('mousedown')\n      textRemark.startSelect = true\n      let $target = e.target\n      if ($target && $target.classList.contains('text-remark-tag')) {\n        let index = $target.getAttribute('data-index')\n        index = index ? parseInt(index) : index\n        let remarkType = $target.getAttribute('data-type')\n        textRemark.dispatchEvent('remark-selected', { target: e.target, remarkType, index, remark: { ...textRemark.remarks[index] } })\n      }\n    },\n    false\n  )\n  textRemark.$container.addEventListener(\n    'mouseup',\n    e => {\n      textRemark.$container.classList.remove('mousedown')\n      textRemark.startSelect = false\n      textRemark.mySelection(e)\n    },\n    false\n  )\n  textRemark.$realText.addEventListener(\n    'mousemove',\n    e => {\n      if (textRemark.startSelect) {\n        textRemark.mySelection(e)\n      }\n    },\n    false\n  )\n}\n// 其它方法\n// 事件属性处理\nfunction mixinEvent(target) {\n  target.__events = target.__events || []\n  let events = target.__events\n  target.on = function (type, cb) {\n    events.push({ type, cb })\n    return target\n  }\n  target.off = function (type, cb) {\n    for (let i = 0; i < events.length; i++) {\n      if (cb === undefined) {\n        events = []\n      } else {\n        let curEvent = events[i]\n        if (curEvent.type === type && curEvent.cb === cb) {\n          events.splice(i, 1)\n          i--\n        }\n      }\n    }\n    return target\n  }\n  target.once = function (type, cb) {\n    const listener = function (...args) {\n      cb.apply(target, args)\n      self.off(type, cb)\n    }\n    return target.on(type, listener)\n  }\n  target.dispatchEvent = function (type, option) {\n    events.forEach(item => {\n      if (item.type === type) {\n        item.cb.call(target, { type, ...option })\n      }\n    })\n    return target\n  }\n}\n// 其它通用方法\nfunction getHashText(text, remarks) {\n  let textMap = Object.create(null)\n  if (remarks.length > 0) {\n    let splitNums = []\n    remarks.forEach(obj => {\n      splitNums.push(obj.baseOffset)\n      splitNums.push(obj.extentOffset)\n    })\n    splitNums.sort((a, b) => a - b)\n    let prevIndex = 0\n    let oriText = text\n    for (let i = 0; i < splitNums.length; i++) {\n      let curIndex = splitNums[i]\n      textMap[curIndex] = oriText.substring(prevIndex, curIndex)\n      prevIndex = curIndex\n    }\n    // 剩余的文本\n    if (prevIndex < oriText.length - 1) {\n      textMap[oriText.length - 1] = oriText.substring(prevIndex)\n    }\n  }\n  return textMap\n}\nfunction getRange(type, section) {\n  // 输出baseOffset < extentOffset\n  // 如果有参数section 采用参数，如果没有，获取当前页面\n  let curSection = section || window.getSelection()\n  let { baseOffset, extentOffset } = curSection\n  let max = Math.max(baseOffset, extentOffset)\n  let min = Math.min(baseOffset, extentOffset)\n  return {\n    baseOffset: min,\n    extentOffset: max,\n    type\n  }\n}\nfunction createElement(tagName, attrs = {}) {\n  // 创建元素\n  const $dom = document.createElement(tagName)\n  for (let key in attrs) {\n    $dom[key] = attrs[key]\n  }\n  return $dom\n}\n\nfunction renderHashText(text, remarks) {\n  let textHashMap = getHashText(text, remarks)\n  if (remarks.length === 0) {\n    return text\n  } else {\n    let resHtml = ''\n    let remarkIndex = 0\n    for (let i = 0; i < remarks.length; i++) {\n      let curObj = remarks[i]\n      if (textHashMap[curObj.baseOffset]) {\n        if (curObj.type === 'active') {\n          textHashMap[curObj.baseOffset] += '<span data-type=\"' + curObj.type + '\" class=\"text-remark-tag text-remark-' + curObj.type + '\">'\n        } else {\n          textHashMap[curObj.baseOffset] += '<span data-type=\"' + curObj.type + '\" data-index=\"' + remarkIndex + '\" class=\"text-remark-tag text-remark-' + curObj.type + '\">'\n        }\n      }\n      if (textHashMap[curObj.extentOffset]) {\n        textHashMap[curObj.extentOffset] += '</span>'\n      }\n      if (curObj.type !== 'active') {\n        remarkIndex++\n      }\n    }\n    for (let key in textHashMap) {\n      resHtml += textHashMap[key]\n    }\n    return resHtml\n  }\n}\n"],"file":"index.js"}