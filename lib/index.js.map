{"version":3,"sources":["../src/index.js"],"names":["TextRemark","options","container","text","remarks","links","console","error","$container","document","querySelector","classList","add","activeRemark","startSelect","$showText","createElement","className","$realText","innerText","addEvents","appendChild","updateShowText","type","data","curSection","getRange","baseOffset","extentOffset","push","index","splice","filter","item","section","canAdd","i","length","obj","baseArr","concat","curHtml","renderHashText","innerHTML","textRemark","mixinEvent","addEventListener","e","$target","target","contains","getAttribute","tagType","dispatchEvent","remark","remove","mySelection","__events","events","on","cb","off","undefined","curEvent","once","listener","args","apply","self","option","forEach","call","getHashText","textMap","Object","create","splitNums","sort","a","b","prevIndex","oriText","curIndex","substring","window","getSelection","max","Math","min","tagName","attrs","$dom","key","textHashMap","resHtml","remarkIndex","curObj"],"mappings":"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","sourcesContent":["export default class TextRemark {\n  constructor(options) {\n    const { container, text = '', remarks = [], links = [] } = options\n    if (!container || !text) {\n      console.error('TextRemark need a container and text')\n      return\n    }\n    if (typeof container === 'string') {\n      this.$container = document.querySelector(container)\n    } else {\n      this.$container = container\n    }\n    this.$container.classList.add('text-remark')\n    this.text = text\n    this.remarks = remarks\n    this.links = links\n    this.activeRemark = null\n    this.startSelect = false\n    //显示\n    this.$showText = createElement('div', { className: 'text-remark-content' })\n    this.$realText = createElement('div', { className: 'text-remark-content real-text' })\n    this.$realText.innerText = text\n    addEvents(this)\n    this.$container.appendChild(this.$realText)\n    this.$container.appendChild(this.$showText)\n\n    this.updateShowText()\n  }\n  addRemark(type, data = {}) {\n    // 获取当前的active\n    // data为默认的数据\n    if (this.activeRemark) {\n      let curSection = getRange(type, this.activeRemark)\n      if (curSection.baseOffset !== curSection.extentOffset) {\n        this.remarks.push({ type, baseOffset: curSection.baseOffset, extentOffset: curSection.extentOffset, data })\n        this.activeRemark = null\n        this.updateShowText()\n      }\n    }\n  }\n  removeRemark(index) {\n    this.remarks.splice(index, 1)\n    this.updateShowText()\n  }\n  getJson() {\n    return {\n      text: this.text,\n      remarks: this.remarks.filter(item => item.type !== 'active')\n    }\n  }\n  clearActive() {\n    this.activeRemark = null\n    this.updateShowText()\n  }\n  mySelection() {\n    let section = getRange('active')\n    let canAdd = true\n    for (let i = 0; i < this.remarks.length; i++) {\n      let obj = this.remarks[i]\n      if (section.baseOffset >= obj.baseOffset && section.baseOffset <= obj.extentOffset) {\n        canAdd = false\n        break\n      } else if (section.extentOffset >= obj.baseOffset && section.extentOffset <= obj.extentOffset) {\n        canAdd = false\n        break\n      }\n    }\n    if (canAdd && section.baseOffset !== section.extentOffset) {\n      this.activeRemark = getRange('active')\n      this.updateShowText()\n    }\n  }\n  updateShowText() {\n    // 合并默认标记数据和已有的标记数据\n    let baseArr = this.activeRemark ? [this.activeRemark] : []\n    let remarks = baseArr.concat(this.remarks)\n    let curHtml = renderHashText(this.text, remarks)\n    this.$showText.innerHTML = curHtml\n  }\n}\nfunction addEvents(textRemark) {\n  mixinEvent(textRemark)\n  this.$container.addEventListener(\n    'mousedown',\n    e => {\n      textRemark.$container.classList.add('mousedown')\n      textRemark.startSelect = true\n      let $target = e.target\n      if ($target && $target.classList.contains('text-remark-tag')) {\n        let index = $target.getAttribute('data-index')\n        let tagType = $target.getAttribute('data-type')\n        textRemark.dispatchEvent('tag-selected', { target: e.target, tagType, index, remark: { ...textRemark.remarks[index] } })\n      }\n    },\n    false\n  )\n  textRemark.$container.addEventListener(\n    'mouseup',\n    e => {\n      textRemark.$container.classList.remove('mousedown')\n      textRemark.startSelect = false\n      textRemark.mySelection(e)\n    },\n    false\n  )\n  textRemark.$realText.addEventListener(\n    'mousemove',\n    e => {\n      if (textRemark.startSelect) {\n        textRemark.mySelection(e)\n      }\n    },\n    false\n  )\n}\n// 其它方法\n// 事件属性处理\nfunction mixinEvent(target) {\n  target.__events = target.__events || []\n  let events = target.__events\n  target.on = function (type, cb) {\n    events.push({ type, cb })\n    return target\n  }\n  target.off = function (type, cb) {\n    for (let i = 0; i < events.length; i++) {\n      if (cb === undefined) {\n        events = []\n      } else {\n        let curEvent = events[i]\n        if (curEvent.type === type && curEvent.cb === cb) {\n          events.splice(i, 1)\n          i--\n        }\n      }\n    }\n    return target\n  }\n  target.once = function (type, cb) {\n    const listener = function (...args) {\n      cb.apply(target, args)\n      self.off(type, cb)\n    }\n    return target.on(type, listener)\n  }\n  target.dispatchEvent = function (type, option) {\n    events.forEach(item => {\n      if (item.type === type) {\n        item.cb.call(target, { type, ...option })\n      }\n    })\n    return target\n  }\n}\n// 其它通用方法\nfunction getHashText(text, remarks) {\n  let textMap = Object.create(null)\n  if (remarks.length > 0) {\n    let splitNums = []\n    remarks.forEach(obj => {\n      splitNums.push(obj.baseOffset)\n      splitNums.push(obj.extentOffset)\n    })\n    splitNums.sort((a, b) => a - b)\n    let prevIndex = 0\n    let oriText = text\n    for (let i = 0; i < splitNums.length; i++) {\n      let curIndex = splitNums[i]\n      textMap[curIndex] = oriText.substring(prevIndex, curIndex)\n      prevIndex = curIndex\n    }\n    // 剩余的文本\n    if (prevIndex < oriText.length - 1) {\n      textMap[oriText.length - 1] = oriText.substring(prevIndex)\n    }\n  }\n  return textMap\n}\nfunction getRange(type, section) {\n  // 输出baseOffset < extentOffset\n  // 如果有参数section 采用参数，如果没有，获取当前页面\n  let curSection = section || window.getSelection()\n  let { baseOffset, extentOffset } = curSection\n  let max = Math.max(baseOffset, extentOffset)\n  let min = Math.min(baseOffset, extentOffset)\n  return {\n    baseOffset: min,\n    extentOffset: max,\n    type\n  }\n}\nfunction createElement(tagName, attrs = {}) {\n  // 创建元素\n  const $dom = document.createElement(tagName)\n  for (let key in attrs) {\n    $dom[key] = attrs[key]\n  }\n  return $dom\n}\n\nfunction renderHashText(text, remarks) {\n  let textHashMap = getHashText(text, remarks)\n  if (remarks.length === 0) {\n    return text\n  } else {\n    let resHtml = ''\n    let remarkIndex = 0\n    for (let i = 0; i < remarks.length; i++) {\n      let curObj = remarks[i]\n      if (textHashMap[curObj.baseOffset]) {\n        if (curObj.type === 'active') {\n          textHashMap[curObj.baseOffset] += '<span data-type=\"' + curObj.type + '\" class=\"text-remark-tag text-remark-' + curObj.type + '\">'\n        } else {\n          textHashMap[curObj.baseOffset] += '<span data-type=\"' + curObj.type + '\" data-index=\"' + remarkIndex + '\" class=\"text-remark-tag text-remark-' + curObj.type + '\">'\n        }\n      }\n      if (textHashMap[curObj.extentOffset]) {\n        textHashMap[curObj.extentOffset] += '</span>'\n      }\n      if (curObj.type !== 'active') {\n        remarkIndex++\n      }\n    }\n    for (let key in textHashMap) {\n      resHtml += textHashMap[key]\n    }\n    return resHtml\n  }\n}\n"],"file":"index.js"}